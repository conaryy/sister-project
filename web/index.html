<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Load Balancer Kelompok 8</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="dashboard">
        <div class="floating-shapes">
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
        </div>
        
        <div class="dashboard-header">
            <h1 class="dashboard-title">
                WEB LOAD BALANCER KELOMPOK 8
            </h2>
            <div class="status-badge">
                <span class="dot"></span>
                Load Balancer Aktif
            </div>
        </div>
        
        <div class="dashboard-content">
            <div class="info-card">
                <h2 class="info-card-title">
                    <i class="fas fa-info-circle"></i>
                    INFORMASI SISTEM
                </h2>
                <p><i class="fas fa-server"></i> Load Balancer berfungsi dengan sempurna!</p>
            </div>
            
            <div class="info-card">
                <h2 class="info-card-title">
                    <i class="fas fa-cogs"></i>
                    SERVER INSTANCE
                </h2>
                <div class="metric-grid">
                    <div class="metric-item">
                        <span class="metric-value" id="uptime">99.9%</span>
                        <div class="metric-label">Waktu Berjalan</div>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value" id="response-time">45ms</span>
                        <div class="metric-label">Waktu Tanggapan</div>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value" id="active-servers">--</span>
                        <div class="metric-label">Server Aktif</div>
                    </div>
                </div>
            </div>
            
            <div class="info-card">
                <h2 class="info-card-title">
                    <i class="fas fa-chart-line"></i>
                    STACK MONITORING
                </h2>
                <ul class="url-list">
                    <li class="url-item">
                        <i class="fas fa-search url-icon"></i>
                        <span class="url-text">Monitoring: Prometheus + Grafana</span>
                    </li>
                    <li class1>
                        <i class="fas fa-balance-scale url-icon"></i>
                        <span class="url-text">Load Balancer: Nginx</span>
                    </li>
                </ul>
            </div>
            
            <div class="info-card">
                <h2 class="info-card-title">
                    <i class="fas fa-link"></i>
                    URL MONITORING
                </h2>
                <ul class="url-list">
                    <li class="url-item">
                        <i class="fas fa-search url-icon"></i>
                        <span class="url-text">Prometheus</span>
                        <a href="http://localhost:9090" class="url-link" target="_blank">
                            http://localhost:9090
                            <i class="fas fa-external-link-alt"></i>
                        </a>
                    </li>
                    <li class="url-item">
                        <i class="fas fa-chart-line url-icon"></i>
                        <span class="url-text">Grafana</span>
                        <a href="http://localhost:3000" class="url-link" target="_blank">
                            http://localhost:3000
                            <i class="fas fa-external-link-alt"></i>
                        </a>
                    </li>
                    <li class="url-item">
                        <i class="fas fa-balance-scale url-icon"></i>
                        <span class="url-text">Load Balancer</span>
                        <a href="http://localhost:8080" class="url-link" target="_blank">
                            http://localhost:8080
                            <i class="fas fa-external-link-alt"></i>
                        </a>
                    </li>
                </ul>
            </div>
            
            <div class="info-card">
                <h2 class="info-card-title">
                    <i class="fas fa-tachometer-alt"></i>
                    SERVER STATUS
                </h2>
                <div class="metric-grid">
                    <div class="metric-item">
                        <span class="metric-value" id="web1-status">--</span>
                        <div class="metric-label">Web 1</div>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value" id="web2-status">--</span>
                        <div class="metric-label">Web 2</div>
                    </div>
                </div>
                <div id="api-status" style="margin-top: 1rem; padding: 1rem; border-radius: 8px; background: rgba(255, 255, 255, 0.05); display: none;"></div>
            </div>
            
            <div class="timestamp" id="timestamp">
                <i class="far fa-clock"></i>
                <span>Mengambil data...</span>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Update timestamp
            function updateTimestamp() {
                const now = new Date();
                const options = {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                };
                const timestamp = document.getElementById('timestamp');
                timestamp.innerHTML = `<i class="far fa-clock"></i> Muat pada: ${now.toLocaleString('id-ID', options)}`;
            }
            
            updateTimestamp();
            setInterval(updateTimestamp, 1000);
            
            // Simulate real-time metrics update
            const uptimeElement = document.getElementById('uptime');
            const responseElement = document.getElementById('response-time');
            const serversElement = document.getElementById('active-servers');
            
            setInterval(() => {
                // Update uptime (99.8% - 100%)
                const uptime = (99.8 + Math.random() * 0.2).toFixed(1);
                uptimeElement.textContent = uptime + '%';
                
                // Update response time (40ms - 60ms)
                const response = Math.floor(40 + Math.random() * 20);
                responseElement.textContent = response + 'ms';
                
                // Calculate active servers based on web1 and web2 status
                const web1Status = document.getElementById('web1-status').textContent;
                const web2Status = document.getElementById('active-servers');
                
                let activeServers = 0;
                if (web1Status === 'Aktif') activeServers++;
                if (web2Status === 'Aktif') activeServers++;
                
                serversElement.textContent = activeServers.toString();
            }, 3000);
            
            // Function to fetch Prometheus data
            async function fetchPrometheusData(query, elementId, label) {
                const url = `http://localhost:9090/api/v1/query?query=${encodeURIComponent(query)}`;
                const apiStatus = document.getElementById('api-status');
                
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.status === "success" && data.data.result && data.data.result.length > 0) {
                        let value = parseFloat(data.data.result[0].value[1]);
                        document.getElementById(elementId).textContent = value > 0 ? 'Aktif' : 'Tidak Aktif';
                        
                        // Update active servers count
                        const web1Status = document.getElementById('web1-status').textContent;
                        const web2Status = document.getElementById('web2-status').textContent;
                        
                        let activeServers = 0;
                        if (web1Status === 'Aktif') activeServers++;
                        if (web2Status === 'Aktif') activeServers++;
                        
                        document.getElementById('active-servers').textContent = activeServers.toString();
                        
                        apiStatus.style.display = 'block';
                        apiStatus.style.color = 'var(--success-color)';
                        apiStatus.textContent = `Informasi ${label} berhasil didapatkan dari Prometheus.`;
                    } else {
                        throw new Error("No data found in response");
                    }
                } catch (error) {
                    console.error(`Error fetching Prometheus data: ${error}`);
                    apiStatus.style.display = 'block';
                    apiStatus.style.color = 'var(--danger-color)';
                    apiStatus.textContent = `Gagal mendapatkan informasi ${label} dari Prometheus: ${error.message}`;
                }
            }
            
            // Fetch data for web servers
            async function fetchAllMetrics() {
                await fetchPrometheusData('nginx_connections_active{job="web1-server"}', 'web1-status', 'Web 1');
                await fetchPrometheusData('nginx_connections_active{job="web2-server"}', 'web2-status', 'Web 2');
            }
            
            // Initial fetch
            fetchAllMetrics();
            
            // Fetch data every 10 seconds
            setInterval(fetchAllMetrics, 10000);
        });
    </script>
</body>
</html>